(()=>{"use strict";var e={d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>o});const o={onLoad:async()=>{const e=window.vendetta.metro.findByProps("uploadFiles"),t=window.vendetta.metro.findByProps("getAPIBaseURL"),o=window.vendetta.patcher.before("uploadFiles",e,(async(e,o)=>{try{const[a,n,r,s]=e;if(n&&Array.isArray(n)){const e=n.filter((e=>e.filename?.toLowerCase().endsWith(".mp3")||"audio/mpeg"===e.mimeType||"audio/mpeg"===e.type));if(0!==e.length){for(const o of(e[1]=n.filter((t=>!e.includes(t))),e))await async function(e,o){try{window.vendetta.ui.toasts.showToast("MP3 donusturuluyor...","info");const a=await(n=o,new Promise(((e,t)=>{const o=new FileReader;o.onload=()=>e(o.result),o.onerror=t,o.readAsArrayBuffer(n)}))),n=a.byteLength,r=await async function(e,o){const a=t.getAPIBaseURL(),n=await fetch(`${a}/v10/channels/${e}/attachments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.GLOBAL_ENV.TOKEN},body:JSON.stringify({files:[{filename:"voice-message.ogg",file_size:o,id:"0"}]})});if(!n.ok)throw new Error(`Upload URL alinamadi: ${n.status}`);const r=await n.json();return{upload_url:r.attachments[0].upload_url,upload_filename:r.attachments[0].upload_filename}}(e,n);await async function(e,t){const o=await fetch(e,{method:"PUT",headers:{"Content-Type":"audio/mpeg"},body:t});if(!o.ok)throw new Error(`Dosya yukleme hatasi: ${o.status}`)}(r.upload_url,a);const s=function(e){const t=16e3;return Math.max(1,Math.min(Math.floor(e/t),3600))}(n),i=function(){const e=new Uint8Array(256);for(let t=0;t<256;t++){const o=.5*Math.sin(t/20)+.3*(Math.random()-.5),a=255*(o+1)/2;e[t]=Math.floor(Math.max(0,Math.min(255,a)))}let t="";for(let o=0;o<e.length;o++)t+=String.fromCharCode(e[o]);return btoa(t)}();await async function(e,o){const{uploadedFilename:a,filename:n,duration:r,waveform:s}=o,i=t.getAPIBaseURL(),l=await fetch(`${i}/v10/channels/${e}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.GLOBAL_ENV.TOKEN},body:JSON.stringify({flags:8192,attachments:[{id:"0",filename:n,uploaded_filename:a,duration_secs:r,waveform:s}]})});if(!l.ok){const e=await l.text();throw new Error(`Mesaj gonderilemedi: ${l.status} - ${e}`)}return await l.json()}(e,{uploadedFilename:r.upload_filename,filename:"voice-message.ogg",duration:s,waveform:i}),window.vendetta.ui.toasts.showToast("Voice message gonderildi","success")}catch(e){console.error("[MP3ToVoice] Gonderme hatasi:",e),window.vendetta.ui.toasts.showToast("Voice message gonderilemedi: "+e.message,"error")}var n}(a,o)}}}catch(e){console.error("[MP3ToVoice] Upload patch hatasi:",e),window.vendetta.ui.toasts.showToast("MP3 gonderilemedi: "+e.message,"error")}}));window.vendetta.ui.toasts.showToast("MP3 to Voice Message aktif","success"),window.__MP3ToVoice_unpatch=o},onUnload:()=>{window.__MP3ToVoice_unpatch&&(window.__MP3ToVoice_unpatch(),delete window.__MP3ToVoice_unpatch),window.vendetta.ui.toasts.showToast("MP3 to Voice Message kapatildi","info")}};module.exports=t})();
