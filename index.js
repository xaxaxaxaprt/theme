(function(u,h,d,s){"use strict";const m=d.findByProps("uploadFiles","upload"),f=d.findByProps("getAPIBaseURL");let l=[];const w={IS_VOICE_MESSAGE:1<<13};var g={onLoad:function(){try{console.log("[MP3ToVoice] Plugin yukleniyor...");const o=h.before("uploadFiles",m,async function(n){try{const[e,t,a,c]=n;if(!t||!Array.isArray(t))return;const i=t.filter(function(r){return r.filename?.toLowerCase().endsWith(".mp3")||r.mimeType==="audio/mpeg"||r.type==="audio/mpeg"});if(i.length===0)return;n[1]=t.filter(function(r){return!i.includes(r)});for(const r of i)await p(e,r)}catch(e){console.error("[MP3ToVoice] Upload patch hatasi:",e),s.showToast("MP3 gonderilemedi: "+e.message,"error")}});l.push(o),s.showToast("MP3 to Voice Message aktif","success")}catch(o){console.error("[MP3ToVoice] Yukleme hatasi:",o),s.showToast("Plugin yukleme hatasi: "+o.message,"error")}},onUnload:function(){l.forEach(function(o){return o()}),l=[],s.showToast("MP3 to Voice Message kapatildi","info")}};async function p(o,n){try{s.showToast("MP3 donusturuluyor...","info");const e=await T(n),t=e.byteLength,a=await y(o,t);await M(a.upload_url,e);const c=A(t),i=_();await P(o,{uploadedFilename:a.upload_filename,filename:"voice-message.ogg",duration:c,waveform:i}),s.showToast("Voice message gonderildi","success")}catch(e){console.error("[MP3ToVoice] Gonderme hatasi:",e),s.showToast("Voice message gonderilemedi: "+e.message,"error")}}async function y(o,n){const e=f.getAPIBaseURL(),t=await fetch(`${e}/v10/channels/${o}/attachments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.GLOBAL_ENV.TOKEN},body:JSON.stringify({files:[{filename:"voice-message.ogg",file_size:n,id:"0"}]})});if(!t.ok)throw new Error(`Upload URL alinamadi: ${t.status}`);const a=await t.json();return{upload_url:a.attachments[0].upload_url,upload_filename:a.attachments[0].upload_filename}}async function M(o,n){const e=await fetch(o,{method:"PUT",headers:{"Content-Type":"audio/mpeg"},body:n});if(!e.ok)throw new Error(`Dosya yukleme hatasi: ${e.status}`)}async function P(o,{uploadedFilename:n,filename:e,duration:t,waveform:a}){const c=f.getAPIBaseURL(),i=await fetch(`${c}/v10/channels/${o}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:window.GLOBAL_ENV.TOKEN},body:JSON.stringify({flags:w.IS_VOICE_MESSAGE,attachments:[{id:"0",filename:e,uploaded_filename:n,duration_secs:t,waveform:a}]})});if(!i.ok){const r=await i.text();throw new Error(`Mesaj gonderilemedi: ${i.status} - ${r}`)}return await i.json()}function T(o){return new Promise(function(n,e){const t=new FileReader;t.onload=function(){return n(t.result)},t.onerror=e,t.readAsArrayBuffer(o)})}function _(){const o=new Uint8Array(256);for(let e=0;e<256;e++){const t=Math.sin(e/20)*.5,a=(Math.random()-.5)*.3,c=(t+a+1)/2*255;o[e]=Math.floor(Math.max(0,Math.min(255,c)))}let n="";for(let e=0;e<o.length;e++)n+=String.fromCharCode(o[e]);return btoa(n)}function A(o){const n=Math.floor(o/16e3);return Math.max(1,Math.min(n,3600))}return u.default=g,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.patcher,vendetta.metro,vendetta.ui.toasts);
